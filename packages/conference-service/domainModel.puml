@startuml

package utility {
  class イベント属性 {
    イベントID
    イベント日時
  }

  class ドメインイベント {
    イベント属性
  }
}



package カンファレンスpackage {
  package 公開package {

    class 公開 {
      カンファレンスID
    }

    enum 公開ステータス {
      未公開
      公開中
    }

    class カンファレンス {
      カンファレンスID
      公開ステータス
      公開する(): 公開
    }

    ドメインイベント <|-- 公開
    カンファレンス --> 公開
    カンファレンス o-- 公開ステータス
  }

  package 参加上限数package {

    class 参加上限数 {
    }

    class 参加上限数変更 {
      カンファレンスID
      参加上限数
    }

    class 参加上限 {
      カンファレンスID
      参加上限数
      変更する(): 参加上限数変更
    }


    class 参加上限数変更サービス {
      変更(カンファレンス, タイムライン, 参加上限数)
    }


    ドメインイベント <|-- 参加上限数変更
    参加上限数変更 o-- 参加上限数
    参加上限 o-- 参加上限数
    参加上限 --> 参加上限数変更

    note top of 参加上限数
      1人以上、1000人以下
    endnote

    note top of 参加上限数変更サービス {
      カンファレンス公開前は、変更できる
      応募受付期間#終了日時まで参加上限数を変更できる
      応募受付期間#終了日時を過ぎると変更できない
    }
  }

  package 説明package {
    class 説明 {
    }

    class 説明変更 {
      カンファレンスID
      説明
    }

    class カンファレンス説明 {
      カンファレンスID
      説明
      変更する(): 説明変更
    }
    ドメインイベント <|-- 説明変更
    説明変更 o-- 説明
    カンファレンス説明 o-- 説明
    カンファレンス説明 --> 説明変更

    note top of 説明
      100文字以上
    endnote
  }

  package タイムラインpackage {
    interface 期間 {
      開始日時
      終了日時
    }
    class 応募受付期間 {
      開始日時
      終了日時
    }

    note bottom of 応募受付期間
      開始日時 + 3 <= 終了日時
    endnote


    class 抽選期間 {
      開始日時
      終了日時
    }

    note bottom of 抽選期間
      開始日時 + 3 <= 終了日時
    endnote

    enum タイムラインステータス {
      応募待ち
      応募受付中
      抽選待ち
      抽選中
      カンファレンス確定待ち
      カンファレンス開始待ち
      カンファレンス中
      カンファレンス終了済み
    }

    class タイムライン {
      応募受付期間
      抽選期間
      カンファレンス開催確定日時
      カンファレンス開始日時
      参加辞退受付期間()
      ステータス(現在)
    }
    class タイムライン変更サービス {
      変更(公開ステータス, Partial<タイムライン>): Either<タイムライン変更エラー, タイムライン変更>
    }

    class タイムライン変更 {
      イベント属性
      タイムライン
    }
    class タイムライン変更エラー {
    }

    期間 <|-- 抽選期間
    期間 <|-- 応募受付期間
    期間 <|-- 参加辞退受付期間
    タイムライン o-- 応募受付期間
    タイムライン o-- 抽選期間
    タイムライン <-- 参加辞退受付期間
    タイムライン --> タイムラインステータス
    タイムライン変更サービス --> タイムライン変更エラー
    タイムライン変更サービス --> タイムライン

    note top of タイムライン
      validationルール: 現在よりも1週間先である
      応募受付期間#終了日時 <= 抽選期間#開始日時
      抽選期間#終了日時 <= 確定日時 + 1
      カンファレンス開催確定日時 <= カンファレンス開始日時 + 1
      参加辞退受付期間は、開始日時=抽選期間#終了日時、終了日時=カンファレンス確定日時である。
    endnote

    note top of タイムライン変更サービス
      カンファレンス公開前は、タイムラインの全てを変更できる
      応募待ち状態では、タイムラインの全てを変更できる
      応募受付中では、応募終了日時・抽選期間・カンファレンス開催確定日時が変更できる
      抽選待ちでは、抽選期間・カンファレンス開催確定日時が変更できる
      抽選中では、抽選終了日時・カンファレンス開催確定日時が変更できる
      カンファレンス確定待ちでは、カンファレンス開催確定日時が変更できる
      「カンファレンス開始待ち」移行は、変更できない
    endnote

  }
  タイムライン変更サービス --> カンファレンス
}

@enduml

' 「カンファレンス説明」はいつでも変更ができる。
